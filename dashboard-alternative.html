<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>

    <!-- Geist Mono from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&display=swap" rel="stylesheet">

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'geist': ['"Geist Mono"', 'monospace'],
            },
            colors: {
              'dash-bg': '#0b0b0d',
              'surface': '#141416',
              'surface-hover': '#19191c',
              'border': 'rgba(255, 255, 255, 0.06)',
              'border-hover': 'rgba(255, 255, 255, 0.1)',
              'muted': '#505058',
              'muted-light': '#7e7e86',
              'text-primary': '#ededef',
              'text-secondary': '#a0a0a8',
            },
          },
        },
      }
    </script>

    <style>
      /* Hide scrollbar */
      body { scrollbar-width: none; }
      body::-webkit-scrollbar { display: none; }

      /* Card system */
      .dash-card {
        --card-color: #fff;
        background: #141416;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        will-change: transform;
      }

      /* Glow overlay â€” injected via JS */
      .card-glow {
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse 80% 55% at 50% 0%, color-mix(in srgb, var(--card-color) 14%, transparent), transparent);
        opacity: 0;
        pointer-events: none;
      }

      /* Accent line â€” injected via JS, expands from center */
      .card-accent {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 0%;
        height: 1.5px;
        background: linear-gradient(90deg, transparent, var(--card-color), transparent);
        opacity: 0;
        pointer-events: none;
        z-index: 1;
      }

      /* Search input */
      #search-input {
        background: #0e0e10;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition: border-color 0.3s ease;
      }
      #search-input:focus {
        border-color: rgba(255, 255, 255, 0.12);
      }

      /* Search button */
      .search-btn {
        background: #141416;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition:
          border-color 0.3s ease,
          background 0.3s ease;
      }
      .search-btn:hover {
        background: #19191c;
        border-color: rgba(255, 255, 255, 0.1);
      }
      .search-btn:active {
        background: #111113;
      }

      /* Separator */
      .divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.04);
      }

      /* Visibility helper for GSAP */
      .gs-hidden { opacity: 0; }

      /* Login overlay */
      #login-overlay {
        position: fixed;
        inset: 0;
        z-index: 100;
        background: #0b0b0d;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #login-overlay.hidden { display: none; }
      #login-box {
        width: 100%;
        max-width: 340px;
        padding: 0 24px;
      }
      #login-box input {
        background: #0e0e10;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition: border-color 0.3s ease;
      }
      #login-box input:focus {
        border-color: rgba(255, 255, 255, 0.12);
      }
      #login-btn {
        background: #141416;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition: border-color 0.3s ease, background 0.3s ease;
      }
      #login-btn:hover {
        background: #19191c;
        border-color: rgba(255, 255, 255, 0.1);
      }
      #login-error {
        color: #F26F60;
        min-height: 18px;
      }

      /* Linear issue rows */
      .linear-issue-row {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        transition: background 0.2s ease;
        text-decoration: none;
      }
      .linear-issue-row:hover { background: #19191c; }
      .linear-issue-row:last-child { border-bottom: none; }

      /* Linear project rows */
      .linear-project-row {
        display: block;
        padding: 12px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        transition: background 0.2s ease;
        text-decoration: none;
      }
      .linear-project-row:hover { background: #19191c; }
      .linear-project-row:last-child { border-bottom: none; }

      /* Status & health dots */
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
      }
      .health-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        flex-shrink: 0;
        display: inline-block;
      }

      /* Priority indicators */
      .priority-urgent { color: #F26F60; }
      .priority-high { color: #F2994A; }
      .priority-medium { color: #F2C94C; }

      /* Skeleton loader */
      @keyframes skeleton-pulse {
        0%, 100% { opacity: 0.04; }
        50% { opacity: 0.08; }
      }
      .skeleton-line {
        height: 12px;
        background: #fff;
        border-radius: 4px;
        animation: skeleton-pulse 1.5s ease-in-out infinite;
      }

      /* Search prefix hints */
      .prefix-hint {
        font-size: 10px;
        letter-spacing: 0.04em;
        color: #505058;
        cursor: pointer;
        padding: 3px 8px;
        border-radius: 6px;
        border: 1px solid transparent;
        transition: color 0.2s ease, border-color 0.2s ease;
        user-select: none;
      }
      .prefix-hint:hover {
        color: #7e7e86;
        border-color: rgba(255, 255, 255, 0.06);
      }
      .prefix-hint .prefix-key {
        color: #7e7e86;
        font-weight: 600;
      }
      .prefix-hint.active {
        color: var(--hint-color, #7e7e86);
        border-color: var(--hint-color, rgba(255, 255, 255, 0.1));
      }
      .prefix-hint.active .prefix-key {
        color: var(--hint-color, #7e7e86);
      }

      /* Active prefix dot in search button */
      .prefix-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        flex-shrink: 0;
        transition: background 0.2s ease;
      }

      /* Line clamp fallback */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* F1 section */
      .f1-digit-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0.025);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 10px 0;
        min-width: 60px;
        transition: border-color 0.3s ease;
      }
      .f1-digit {
        font-size: 22px;
        font-weight: 600;
        color: #ededef;
        line-height: 1;
        letter-spacing: -0.03em;
        font-variant-numeric: tabular-nums;
      }
      .f1-unit {
        font-size: 9px;
        color: #505058;
        letter-spacing: 0.12em;
        margin-top: 6px;
        text-transform: uppercase;
      }

      /* Live pulse for race-in-progress */
      @keyframes f1-live-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.4; }
      }
      .f1-live-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #E10600;
        display: inline-block;
        animation: f1-live-pulse 1.5s ease-in-out infinite;
      }


    </style>
  </head>

  <body class="font-geist bg-dash-bg text-text-primary min-h-screen overflow-x-hidden">

    <!-- Login overlay -->
    <div id="login-overlay">
      <div id="login-box">
        <h1 class="text-2xl font-semibold tracking-tight text-text-primary mb-8 text-center">Dashboard</h1>
        <form id="login-form" class="flex flex-col gap-3">
          <input
            id="login-password"
            type="password"
            autocomplete="current-password"
            placeholder="Password"
            class="h-10 rounded-lg px-4 text-[13px] text-text-primary placeholder-muted focus:outline-none w-full"
          >
          <button
            type="submit"
            id="login-btn"
            class="h-10 rounded-lg text-[13px] text-muted-light cursor-pointer w-full"
          >
            Sign in
          </button>
          <p id="login-error" class="text-[11px] text-center">&nbsp;</p>
        </form>
      </div>
    </div>

    <!-- Main content (hidden until authenticated) -->
    <main class="min-h-screen flex flex-col px-6 sm:px-10 lg:px-16 py-16 lg:py-20 mx-auto" style="max-width: 1060px; display: none;">

      <!-- Header -->
      <header class="flex items-start justify-between mb-14 gs-hidden" id="header">
        <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight text-text-primary">Hey!&nbsp;ðŸ‘‹</h1>
        <div class="flex items-center gap-4">
          <div class="text-right text-muted-light text-xs leading-relaxed tracking-wide">
            <div id="date-display"></div>
            <div><span id="time-display">00:00:00</span> Uhr</div>
          </div>
          <button
            id="logout-btn"
            title="Logout"
            class="search-btn h-8 w-8 rounded-lg flex items-center justify-center text-muted-light cursor-pointer"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 17L21 12M21 12L16 7M21 12H9M9 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </header>

      <!-- Search bar -->
      <form id="search-form" class="flex items-center gap-3 mb-3 gs-hidden">
        <input
          id="search-input"
          type="text"
          autocomplete="off"
          class="flex-1 h-10 rounded-lg px-4 text-[13px] text-text-primary placeholder-muted focus:outline-none"
          placeholder=""
        >
        <button
          type="submit"
          id="search-btn"
          class="search-btn h-10 px-4 rounded-lg flex items-center gap-2 text-[13px] text-muted-light cursor-pointer whitespace-nowrap"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.4" d="M1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12Z" fill="currentColor"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16C13.8638 16 15.4299 14.7252 15.874 13H12C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11H17C17.5523 11 18 11.4477 18 12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C13.6566 6 15.1579 6.67267 16.2426 7.75736C16.6332 8.14788 16.6332 8.78105 16.2426 9.17157C15.8521 9.5621 15.219 9.5621 14.8284 9.17157C14.1035 8.44662 13.1048 8 12 8Z" fill="currentColor"/>
          </svg>
          Search
        </button>
      </form>
      <div id="search-hints" class="flex flex-wrap items-center gap-x-2 gap-y-1 mb-12 gs-hidden"></div>

      <!-- Bookmark cards grid -->
      <section class="grid grid-cols-2 lg:grid-cols-3 gap-3 mb-auto" id="card-grid">

        <!-- Card: Canny -->
        <a href="https://edith.canny.io/" target="_blank" rel="noopener" data-card-id="canny" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #525DF9">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Canny</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: Docmost -->
        <a href="https://wiki.intern.edith-bahn.de/home" target="_blank" rel="noopener" data-card-id="docmost" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #0B60D8">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Docmost</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: GitLab -->
        <a href="https://gitlab.dev.edith-bahn.de/" target="_blank" rel="noopener" data-card-id="gitlab" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #E24329">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">GitLab</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: Localhost -->
        <a href="http://localhost:5173/" target="_blank" rel="noopener" data-card-id="localhost" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FFFFFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Localhost</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: Mobbin -->
        <a href="https://mobbin.com/discover/apps/ios/latest" target="_blank" rel="noopener" data-card-id="mobbin" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FFFFFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Mobbin</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: Rail Network -->
        <a href="https://customer.s.rail-network.de/" target="_blank" rel="noopener" data-card-id="rail-network" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #006AFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Rail Network</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: Suite -->
        <a href="https://suite.intern.edith-bahn.de/" target="_blank" rel="noopener" data-card-id="suite" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #00427F">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Suite</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: YouTrack -->
        <a href="https://edith.youtrack.cloud/tickets?u=1" target="_blank" rel="noopener" data-card-id="youtrack" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #E20F86">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">YouTrack</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

        <!-- Card: YouTube -->
        <a href="https://www.youtube.com/" target="_blank" rel="noopener" data-card-id="youtube" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FF0033">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">YouTube</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="last-access-date text-muted-light text-[11px] tracking-wide">â€“</div>
          </div>
        </a>

      </section>

      <!-- YouTrack Section -->
      <section class="mt-12 gs-hidden" id="youtrack-section">
        <div class="divider mb-8"></div>

        <div class="flex items-center gap-3 mb-5">
          <div class="w-1 h-4 rounded-full" style="background: #E20F86;"></div>
          <h2 class="text-text-primary font-medium text-[15px] tracking-wide">YouTrack</h2>
          <span class="text-muted text-[11px] tracking-wide">Unassigned</span>
        </div>

        <div id="youtrack-content">
          <!-- Loading skeleton -->
          <div id="youtrack-loading" class="hidden">
            <div class="dash-card p-5" style="--card-color: #E20F86">
              <div class="space-y-3">
                <div class="skeleton-line w-3/4"></div>
                <div class="skeleton-line w-1/2"></div>
                <div class="skeleton-line w-2/3"></div>
                <div class="skeleton-line w-3/5"></div>
                <div class="skeleton-line w-1/2"></div>
              </div>
            </div>
          </div>

          <!-- Error state -->
          <div id="youtrack-error" class="hidden dash-card p-5 text-center" style="--card-color: #F26F60">
            <p class="text-muted-light text-[13px]" id="youtrack-error-msg"></p>
          </div>

          <!-- Data display -->
          <div id="youtrack-data" class="hidden">
            <div class="dash-card p-0 overflow-hidden" style="--card-color: #E20F86">
              <div id="youtrack-issues-list"></div>
              <div id="youtrack-issues-empty" class="hidden px-5 py-5 text-muted text-[12px]">No unassigned issues</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Linear Section -->
      <section class="mt-12 gs-hidden" id="linear-section">
        <div class="divider mb-8"></div>

        <div class="flex items-center gap-3 mb-5">
          <div class="w-1 h-4 rounded-full" style="background: #5E6AD2;"></div>
          <h2 class="text-text-primary font-medium text-[15px] tracking-wide">Linear</h2>
        </div>

        <div id="linear-content">
          <!-- Loading skeleton -->
          <div id="linear-loading" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-3">
            <div class="dash-card p-5" style="--card-color: #5E6AD2">
              <div class="text-muted text-[11px] tracking-wide mb-4">My Issues</div>
              <div class="space-y-3">
                <div class="skeleton-line w-3/4"></div>
                <div class="skeleton-line w-1/2"></div>
                <div class="skeleton-line w-2/3"></div>
                <div class="skeleton-line w-3/5"></div>
              </div>
            </div>
            <div class="dash-card p-5" style="--card-color: #5E6AD2">
              <div class="text-muted text-[11px] tracking-wide mb-4">Project Updates</div>
              <div class="space-y-3">
                <div class="skeleton-line w-3/4"></div>
                <div class="skeleton-line w-1/2"></div>
                <div class="skeleton-line w-2/3"></div>
              </div>
            </div>
          </div>

          <!-- Error state -->
          <div id="linear-error" class="hidden dash-card p-5 text-center" style="--card-color: #F26F60">
            <p class="text-muted-light text-[13px]" id="linear-error-msg"></p>
          </div>

          <!-- Data display -->
          <div id="linear-data" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-3">
            <div class="dash-card p-0 overflow-hidden" style="--card-color: #5E6AD2">
              <div class="px-5 pt-5 pb-3">
                <div class="text-muted text-[11px] tracking-wide">My Issues</div>
              </div>
              <div id="issues-list"></div>
              <div id="issues-empty" class="hidden px-5 pb-5 text-muted text-[12px]">No issues assigned</div>
            </div>
            <div class="dash-card p-0 overflow-hidden" style="--card-color: #5E6AD2">
              <div class="px-5 pt-5 pb-3">
                <div class="text-muted text-[11px] tracking-wide">Project Updates</div>
              </div>
              <div id="projects-list"></div>
              <div id="projects-empty" class="hidden px-5 pb-5 text-muted text-[12px]">No project updates</div>
            </div>
          </div>
        </div>
      </section>

      <!-- F1 Section -->
      <section class="mt-12 gs-hidden" id="f1-section">
        <div class="divider mb-8"></div>

        <div class="flex items-center gap-3 mb-5">
          <div class="w-1 h-4 rounded-full" style="background: #E10600;"></div>
          <h2 class="text-text-primary font-medium text-[15px] tracking-wide">Formula 1</h2>
          <span class="text-muted text-[11px] tracking-wide" id="f1-season-label"></span>
        </div>

        <div id="f1-content">
          <!-- Loading skeleton -->
          <div id="f1-loading" class="hidden">
            <div class="dash-card p-6" style="--card-color: #E10600">
              <div class="space-y-4">
                <div class="skeleton-line w-1/4"></div>
                <div class="skeleton-line w-2/3"></div>
                <div class="skeleton-line w-1/3"></div>
                <div class="flex gap-2 mt-4">
                  <div class="skeleton-line" style="width:60px;height:48px;border-radius:10px"></div>
                  <div class="skeleton-line" style="width:60px;height:48px;border-radius:10px"></div>
                  <div class="skeleton-line" style="width:60px;height:48px;border-radius:10px"></div>
                  <div class="skeleton-line" style="width:60px;height:48px;border-radius:10px"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Data display -->
          <div id="f1-data" class="hidden">
            <div class="dash-card p-0 overflow-hidden relative" style="--card-color: #E10600">

              <div class="p-6">
                <!-- Top row: Logo + Round -->
                <div class="flex items-center gap-3 mb-5">
                  <svg width="36" height="15" viewBox="0 0 309 128" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M111.237 24.7655C127.287 24.5818 143.626 24.7378 159.693 24.7378L248.62 24.746C239.38 34.0162 229.614 43.3471 220.23 52.5069C213.907 52.2763 206.603 52.445 200.189 52.4444L163.117 52.4443L131.27 52.4461C120.707 52.4421 105.983 51.944 95.9856 54.6868C87.0744 57.2004 78.2626 66.7303 71.7016 73.0807L54.1702 89.8267C52.0128 91.9205 49.7985 93.9843 47.7269 96.1614C46.7117 97.2283 45.7691 98.2396 44.6792 99.2328L2.47937 99.2475C3.99276 97.8412 5.39962 96.1721 6.8623 94.6966L17.3755 84.2664C18.6844 82.9869 20.1209 81.7895 21.4096 80.5156C25.5447 76.4224 29.6928 72.3395 33.8146 68.2327C37.58 64.4806 41.4105 60.7992 45.0443 56.9196C49.9942 51.7297 55.1553 46.7445 60.5145 41.9767C78.1585 26.2455 88.0276 25.5234 111.237 24.7655Z" fill="#E10600"/>
                    <path d="M215.571 56.8553L215.724 57.0678C215.63 57.3463 215.393 57.7634 215.185 57.9608C210.882 62.0226 206.639 66.2466 202.46 70.4235L194.578 78.3116C193.069 79.8226 191.307 81.6791 189.715 83.0636C187.757 83.1938 184.505 83.095 182.441 83.0946L168.428 83.0917C151.974 83.0884 135.501 83.0532 119.047 83.1056C109.108 83.1372 106.59 84.1344 99.6908 90.9679L91.4449 99.2399L52.6947 99.2226C52.5701 99.1166 52.6261 99.1771 52.6019 98.9369C54.6777 96.7448 56.2962 95.0112 58.5301 92.9465C61.744 89.9763 64.874 86.6723 67.9858 83.564L78.2112 73.3506C82.1857 69.3817 87.7386 63.4252 92.7594 61.005C101.953 56.5731 114.591 56.8602 124.549 56.8591L145.836 56.8611L215.571 56.8553Z" fill="#E10600"/>
                    <path d="M254.631 24.7458C259.569 24.6032 265.221 24.7384 270.205 24.7385L301.028 24.7366C297.944 27.642 294.786 30.9649 291.736 33.9606L264.539 61.0378C251.751 73.8293 238.838 86.249 226.222 99.2398L179.938 99.2248C181.528 97.7446 182.995 95.977 184.533 94.4261L196.764 82.2039L210.174 68.8232C213.141 65.9163 216.238 63.208 219.108 60.1659C220.602 58.5817 222.122 56.9198 223.64 55.379C233.808 45.0046 244.139 34.7923 254.631 24.7458Z" fill="#E10600"/>
                  </svg>
                  <div class="h-3 w-px bg-border"></div>
                  <span class="text-muted text-[11px] tracking-widest uppercase" id="f1-round">Round 1</span>
                </div>

                <!-- Race name + circuit -->
                <h3 class="text-text-primary text-[20px] sm:text-[22px] font-semibold tracking-tight leading-tight mb-1.5" id="f1-race-name"></h3>
                <p class="text-text-secondary text-[12px] tracking-wide mb-6" id="f1-circuit"></p>

                <!-- Countdown blocks -->
                <div class="flex gap-2 sm:gap-3" id="f1-countdown-blocks">
                  <div class="f1-digit-block flex-1">
                    <span class="f1-digit" id="f1-days">--</span>
                    <span class="f1-unit">Days</span>
                  </div>
                  <div class="f1-digit-block flex-1">
                    <span class="f1-digit" id="f1-hours">--</span>
                    <span class="f1-unit">Hrs</span>
                  </div>
                  <div class="f1-digit-block flex-1">
                    <span class="f1-digit" id="f1-mins">--</span>
                    <span class="f1-unit">Min</span>
                  </div>
                  <div class="f1-digit-block flex-1">
                    <span class="f1-digit" id="f1-secs">--</span>
                    <span class="f1-unit">Sec</span>
                  </div>
                </div>

                <!-- Race date/time -->
                <div class="flex items-center justify-between mt-5">
                  <span class="text-muted text-[11px] tracking-wide" id="f1-race-datetime"></span>
                  <span class="text-muted text-[11px] tracking-wide" id="f1-live-label"></span>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <div class="mt-14">
        
        <footer class="flex items-center justify-center gap-1.5 text-muted text-[11px] tracking-wide">
          <span>Made with</span>
          <svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.18621 5.26615L3.61813 2.69266C3.27249 2.34628 3.2756 1.78158 3.6251 1.43136C3.97459 1.08113 4.53811 1.078 4.88375 1.42437L9.42534 5.93077C10.976 7.48471 11.8699 9.52165 10.1389 11.6266L9.95431 11.8116C8.59491 13.1738 6.39084 13.1738 5.0314 11.8116L3.17131 9.97414C2.82567 9.62776 2.83272 9.05913 3.18708 8.70405C3.523 8.36741 4.05042 8.34355 4.39884 8.63703M6.18621 5.26615L7.64985 6.73285M6.18621 5.26615C5.84058 4.91978 5.25824 4.92785 4.90233 5.28451C4.54642 5.64116 4.53811 6.21106 4.88375 6.55744L5.30833 6.98293M4.39884 8.63703L4.03412 8.2823C3.68847 7.93592 3.69679 7.366 4.0527 7.00935C4.4086 6.6527 4.96268 6.63654 5.30833 6.98293M4.39884 8.63703L5.05823 9.27828M4.39884 8.63703C4.41797 8.65313 4.43656 8.67022 4.45455 8.68824M5.30833 6.98293L6.34884 8.02564M7.07935 3.60298C7.177 2.7065 8.23873 1.77718 9.56447 2.41404C9.69035 2.47452 9.7901 2.58893 9.79127 2.72883C9.79308 2.95419 9.69414 3.23242 9.37704 3.41691C8.92344 3.68081 8.18039 4.68916 9.17229 5.68314" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>by Tobias Wenck</span>
        </footer>
      </div>

    </main>

    <script>
      // â”€ Dev mode: bypass auth & gracefully handle API when running locally â”€
      const IS_LOCAL = location.protocol === 'file:'
        || location.hostname === 'localhost'
        || location.hostname === '127.0.0.1';

      // â”€ Auth constants â”€
      const WORKER_URL = 'https://linear-proxy.tobiaswenck.workers.dev';
      const TOKEN_KEY = 'dash_token';

      // â”€ Token helpers â”€
      function getToken() { return localStorage.getItem(TOKEN_KEY); }
      function setToken(t) { localStorage.setItem(TOKEN_KEY, t); }
      function clearToken() { localStorage.removeItem(TOKEN_KEY); }

      // â”€ Last-access tracking (localStorage) â”€
      const LAST_ACCESS_KEY = 'dash_last_access';

      function getLastAccessData() {
        try { return JSON.parse(localStorage.getItem(LAST_ACCESS_KEY)) || {}; }
        catch { return {}; }
      }

      function setLastAccess(cardId) {
        const data = getLastAccessData();
        data[cardId] = new Date().toISOString();
        localStorage.setItem(LAST_ACCESS_KEY, JSON.stringify(data));
      }

      function formatDateDE(isoString) {
        const d = new Date(isoString);
        return d.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
      }

      function populateLastAccessDates() {
        const data = getLastAccessData();
        document.querySelectorAll('#card-grid .dash-card[data-card-id]').forEach(card => {
          const id = card.dataset.cardId;
          const el = card.querySelector('.last-access-date');
          if (el) el.textContent = data[id] ? formatDateDE(data[id]) : 'â€“';
        });
      }

      function initLastAccessTracking() {
        populateLastAccessDates();
        document.querySelectorAll('#card-grid .dash-card[data-card-id]').forEach(card => {
          card.addEventListener('click', () => {
            setLastAccess(card.dataset.cardId);
            card.querySelector('.last-access-date').textContent = formatDateDE(new Date().toISOString());
          });
        });
      }

      /** Decode JWT payload (no verification â€” worker does that) */
      function decodePayload(token) {
        try {
          const base64 = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');
          return JSON.parse(atob(base64));
        } catch { return null; }
      }

      function isTokenValid() {
        const token = getToken();
        if (!token) return false;
        const payload = decodePayload(token);
        if (!payload || !payload.exp) return false;
        return payload.exp > Math.floor(Date.now() / 1000);
      }

      function showApp() {
        document.getElementById('login-overlay').classList.add('hidden');
        document.querySelector('main').style.display = '';
        if (IS_LOCAL) {
          document.getElementById('logout-btn').title = 'Dev mode';
          document.getElementById('logout-btn').style.borderColor = 'rgba(242,201,76,0.3)';
        }
      }

      function showLogin(msg) {
        document.getElementById('login-overlay').classList.remove('hidden');
        document.querySelector('main').style.display = 'none';
        if (msg) document.getElementById('login-error').textContent = msg;
      }

      function logout() {
        clearToken();
        showLogin();
        document.getElementById('login-password').value = '';
        document.getElementById('login-error').innerHTML = '&nbsp;';
      }

      // â”€ Login flow â”€
      document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pw = document.getElementById('login-password').value;
        const errEl = document.getElementById('login-error');
        const btn = document.getElementById('login-btn');

        if (!pw) { errEl.textContent = 'Enter a password'; return; }

        btn.textContent = '...';
        btn.disabled = true;
        errEl.innerHTML = '&nbsp;';

        try {
          const res = await fetch(`${WORKER_URL}/auth`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: pw }),
          });
          const json = await res.json().catch(() => null);

          if (!res.ok) {
            errEl.textContent = json?.error || 'Authentication failed';
            return;
          }

          setToken(json.token);
          showApp();
          initDashboard();
        } catch (err) {
          errEl.textContent = 'Could not reach server';
        } finally {
          btn.textContent = 'Sign in';
          btn.disabled = false;
        }
      });

      // â”€ Logout â”€
      document.getElementById('logout-btn').addEventListener('click', () => {
        if (IS_LOCAL) return; // no-op in dev mode
        logout();
      });

      // â”€â”€ Clock â”€â”€
      function updateClock() {
        const now = new Date();
        const pad = (n) => String(n).padStart(2, '0');
        document.getElementById('date-display').textContent =
          `${pad(now.getDate())}.${pad(now.getMonth() + 1)}.${now.getFullYear()}`;
        document.getElementById('time-display').textContent =
          `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      }
      updateClock();
      setInterval(updateClock, 1000);

      // â”€ Smart search with prefixes â”€
      // Prefix filter icons
      const PREFIX_ICONS = {
        'gl':  '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.4" fill-rule="evenodd" clip-rule="evenodd" d="M5.17969 1.25182C5.49792 1.2297 5.79535 1.41112 5.9212 1.70411L8.77957 8.35852C8.91393 8.67133 8.99219 8.85096 9.0635 8.97743C9.12411 9.08492 9.15475 9.1034 9.27513 9.11637C9.41994 9.13196 9.61646 9.13297 9.95748 9.13297H14.0503C14.3914 9.13297 14.5879 9.13196 14.7327 9.11637C14.8484 9.1039 14.8864 9.08007 14.9443 8.97743C15.0156 8.85096 15.0939 8.67133 15.2282 8.35852L18.0866 1.70411C18.2125 1.41112 18.5099 1.2297 18.8281 1.25182C19.1464 1.27393 19.4158 1.49475 19.4999 1.80234L22.5384 12.9183C22.6172 13.2065 22.6914 13.4777 22.7289 13.7129C22.8244 14.3109 22.6452 14.8468 22.2097 15.2676C22.0383 15.4332 21.8159 15.6057 21.5795 15.7892L13.6817 21.918C13.4077 22.1307 13.1525 22.3288 12.9203 22.4684C12.6625 22.6233 12.3647 22.75 12.0039 22.75C11.6431 22.75 11.3453 22.6233 11.0875 22.4684C10.8554 22.3288 10.6001 22.1307 10.3262 21.918L2.4283 15.7892C2.19187 15.6057 1.96954 15.4332 1.79812 15.2676C1.36258 14.8468 1.18343 14.3109 1.27889 13.7129C1.31644 13.4777 1.39061 13.2065 1.46943 12.9183L4.50794 1.80234C4.59201 1.49475 4.86146 1.27393 5.17969 1.25182Z" fill="currentColor"/><path d="M5.17969 1.25182C5.49792 1.2297 5.79535 1.41112 5.9212 1.70411L8.77957 8.35852C8.91393 8.67133 8.99219 8.85096 9.0635 8.97743C9.12411 9.08492 9.15475 9.1034 9.27513 9.11637C9.41994 9.13196 9.61646 9.13297 9.95748 9.13297H12.0039V22.75C11.6431 22.75 11.3453 22.6233 11.0875 22.4684C10.8554 22.3288 10.6001 22.1307 10.3262 21.918L2.4283 15.7892C2.19187 15.6057 1.96954 15.4332 1.79812 15.2676C1.36258 14.8468 1.18343 14.3109 1.27889 13.7129C1.31644 13.4777 1.39061 13.2065 1.46943 12.9183L4.50794 1.80234C4.59201 1.49475 4.86146 1.27393 5.17969 1.25182Z" fill="currentColor"/></svg>',
        'yt':  '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.4" d="M11.9999 2.75C10.1413 2.75 8.3556 2.93356 6.69662 3.27174L6.56934 3.29766C4.67471 3.68329 3.41231 3.94024 2.32445 5.33892C1.24828 6.72258 1.24888 8.3272 1.24981 10.8124V13.1876C1.24888 15.6728 1.24828 17.2774 2.32445 18.6611C3.41231 20.0598 4.67471 20.3167 6.56934 20.7023L6.69662 20.7283C8.3556 21.0664 10.1413 21.25 11.9999 21.25C13.8585 21.25 15.6441 21.0664 17.3031 20.7283L17.4304 20.7023C19.325 20.3167 20.5874 20.0598 21.6753 18.6611C22.7515 17.2774 22.7509 15.6728 22.7499 13.1876V10.8124C22.7509 8.3272 22.7515 6.72258 21.6753 5.33892C20.5874 3.94024 19.325 3.68329 17.4304 3.29766L17.3031 3.27174C15.6441 2.93356 13.8585 2.75 11.9999 2.75Z" fill="currentColor"/><path d="M13.213 9.25173C12.4429 8.82163 11.813 8.46986 11.2945 8.25224C10.4515 7.89845 9.55759 7.86983 8.82288 8.47181C8.36304 8.84858 8.20049 9.38806 8.12917 9.93172C7.95674 11.2462 7.95682 12.7544 8.12917 14.0683C8.20049 14.6119 8.36304 15.1514 8.82288 15.5282C9.55759 16.1302 10.4515 16.1015 11.2945 15.7478C11.8131 15.5301 12.4429 15.1784 13.213 14.7483C13.8149 14.4122 14.4334 14.0897 14.9949 13.686C15.4145 13.3843 15.8126 13.0104 15.9444 12.4651C16.0184 12.159 16.0184 11.841 15.9444 11.5349C15.8126 10.9896 15.4145 10.6157 14.9949 10.314C14.4334 9.91029 13.8149 9.58784 13.213 9.25173Z" fill="currentColor"/></svg>',
        'li':  '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.56436 14.1332C2.42658 13.9954 2.20058 14.1149 2.24508 14.3046C3.10956 17.9897 6.0103 20.8904 9.69544 21.7549C9.88514 21.7994 10.0046 21.5734 9.86684 21.4356L2.56436 14.1332ZM2.05829 11.5299C2.01815 11.4898 1.99685 11.4345 2.00038 11.3778C2.02989 10.904 2.09237 10.4391 2.18556 9.98534C2.21696 9.83244 2.40482 9.77932 2.51519 9.8897L14.1103 21.4848C14.2207 21.5952 14.1676 21.783 14.0147 21.8144C13.5609 21.9076 13.096 21.9701 12.6222 21.9996C12.5655 22.0032 12.5102 21.9818 12.4701 21.9417L2.05829 11.5299ZM2.88372 8.16108C2.82585 8.1032 2.80889 8.01584 2.84219 7.94108C3.0013 7.58386 3.18072 7.23766 3.37898 6.90398C3.44459 6.79356 3.59631 6.77652 3.68713 6.86734L17.1327 20.3129C17.2235 20.4037 17.2064 20.5554 17.096 20.621C16.7623 20.8193 16.4161 20.9987 16.0589 21.1578C15.9842 21.1911 15.8968 21.1742 15.8389 21.1163L2.88372 8.16108Z" fill="currentColor"/><path d="M4.53174 5.6148C4.45772 5.54078 4.45314 5.42206 4.52288 5.34398C6.3559 3.29186 9.02228 2 11.9904 2C17.5185 2 22 6.48146 22 12.0096C22 14.9777 20.7081 17.6441 18.656 19.4771C18.578 19.5469 18.4592 19.5423 18.3852 19.4683L4.53174 5.6148Z" fill="currentColor"/></svg>',
        'gpt': '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.8314 2.25C8.5553 2.25 6.72876 4.05765 6.72876 6.26471V11.6721L8.50358 12.717L8.50317 7.03256C8.50315 6.82597 8.61425 6.63534 8.79401 6.53351L13.8563 3.66586C13.8791 3.65291 13.9021 3.64014 13.925 3.62756C13.1736 2.78424 12.0675 2.25 10.8314 2.25Z" fill="currentColor"/><path d="M9.65063 10.5581L9.65084 13.3923L11.9533 14.7478L14.4091 13.4101L14.4561 10.67L12.0479 9.25232L9.65063 10.5581Z" fill="currentColor"/><path d="M13.2224 8.61258L18.1368 11.5058C18.3119 11.6088 18.4194 11.7968 18.4194 12V17.7353C18.4194 17.7628 18.4192 17.7902 18.4187 17.8175C19.5525 17.6046 20.5843 16.9282 21.2026 15.8776C22.3287 13.9638 21.6649 11.5115 19.7025 10.3998L14.9176 7.68921L13.2224 8.61258Z" fill="currentColor"/><path d="M14.3865 14.7286L9.35197 17.4709C9.17795 17.5657 8.96732 17.5639 8.7949 17.4662L3.7327 14.5986C3.70305 14.5818 3.67364 14.5648 3.64445 14.5475C3.26941 15.6088 3.34917 16.816 3.96603 17.8643C5.09604 19.7847 7.60832 20.4507 9.57688 19.3355L14.3539 16.6294L14.3865 14.7286Z" fill="currentColor"/><g opacity="0.4"><path d="M20.3539 9.45163C20.7288 8.39038 20.649 7.18332 20.0322 6.13508C18.9022 4.2147 16.3899 3.54868 14.4214 4.66383L9.65002 7.36671L9.65016 9.25188L14.6484 6.52943C14.8224 6.43464 15.033 6.4364 15.2054 6.53407L20.2676 9.40172C20.2966 9.41813 20.3253 9.43477 20.3539 9.45163Z" fill="currentColor"/><path d="M15.5916 11.3386L15.4949 16.9767C15.4915 17.1797 15.3809 17.3658 15.2042 17.4659L10.142 20.3335C10.1196 20.3462 10.0971 20.3587 10.0746 20.3711C10.8259 21.2151 11.9325 21.7499 13.1692 21.7499C15.4454 21.7499 17.2719 19.9423 17.2719 17.7352V12.3278L15.5916 11.3386Z" fill="currentColor"/><path d="M10.7785 15.3874L8.8055 14.2259C8.79257 14.2189 8.77995 14.2115 8.76765 14.2036L5.86393 12.4942C5.68885 12.3911 5.58136 12.2031 5.58136 11.9999V6.26468C5.58136 6.23731 5.58158 6.21 5.58201 6.18274C4.44805 6.39554 3.41608 7.07197 2.79778 8.12275C1.67163 10.0365 2.3354 12.4888 4.29779 13.6005L9.08274 16.3111L10.7785 15.3874Z" fill="currentColor"/></g></svg>',
      };

      const SEARCH_PREFIXES = {
        'gl':   { label: 'GitLab',   color: '#E24329', url: q => q ? `https://gitlab.dev.edith-bahn.de/search?search=${encodeURIComponent(q)}` : 'https://gitlab.dev.edith-bahn.de/' },
        'yt':   { label: 'YouTube',  color: '#FF0033', url: q => q ? `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}` : 'https://www.youtube.com/' },
        'li':   { label: 'Linear',   color: '#5E6AD2', url: q => q ? `https://linear.app/edithgmbh/search?q=${encodeURIComponent(q)}` : 'https://linear.app/edithgmbh/' },
        'gpt':  { label: 'ChatGPT',  color: '#10A37F', url: q => q ? `https://chatgpt.com/?q=${encodeURIComponent(q)}` : 'https://chatgpt.com/' },
      };

      const searchInput = document.getElementById('search-input');
      const searchBtn = document.getElementById('search-btn');
      const defaultBtnHTML = searchBtn.innerHTML;

      // Build prefix hints
      const hintsContainer = document.getElementById('search-hints');
      Object.entries(SEARCH_PREFIXES).forEach(([key, cfg]) => {
        const el = document.createElement('span');
        el.className = 'prefix-hint';
        el.dataset.prefix = key;
        el.style.setProperty('--hint-color', cfg.color);
        el.innerHTML = `<span class="prefix-key">${key}:</span> ${cfg.label}`;
        el.addEventListener('click', () => {
          const current = detectPrefix(searchInput.value);
          if (current && current.key === key) {
            searchInput.value = '';
          } else {
            searchInput.value = key + ': ';
          }
          searchInput.focus();
          searchInput.dispatchEvent(new Event('input'));
        });
        hintsContainer.appendChild(el);
      });

      // Detect active prefix on input
      function detectPrefix(value) {
        const match = value.match(/^(\w+):\s*(.*)/);
        if (match && SEARCH_PREFIXES[match[1].toLowerCase()]) {
          return { key: match[1].toLowerCase(), query: match[2].trim() };
        }
        return null;
      }

      searchInput.addEventListener('input', () => {
        const detected = detectPrefix(searchInput.value);

        // Update button
        if (detected) {
          const cfg = SEARCH_PREFIXES[detected.key];
          searchBtn.innerHTML = `${PREFIX_ICONS[detected.key]} ${cfg.label}`;
          searchBtn.style.borderColor = cfg.color + '33';
          searchBtn.style.color = cfg.color;
        } else {
          searchBtn.innerHTML = defaultBtnHTML;
          searchBtn.style.borderColor = '';
          searchBtn.style.color = '';
        }

        // Update hint highlights
        hintsContainer.querySelectorAll('.prefix-hint').forEach(el => {
          el.classList.toggle('active', detected?.key === el.dataset.prefix);
        });
      });

      // Submit handler
      document.getElementById('search-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const raw = searchInput.value.trim();
        if (!raw) return;

        const detected = detectPrefix(raw);
        if (detected) {
          const cfg = SEARCH_PREFIXES[detected.key];
          window.location.href = cfg.url(detected.query);
          return;
        }

        // Default: Google
        window.location.href = 'https://www.google.com/search?q=' + encodeURIComponent(raw);
      });

      // Keyboard shortcut: "/" to focus search (when not already in an input)
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && !['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) {
          e.preventDefault();
          searchInput.focus();
        }
      });

      // â”€ Linear Proxy â”€
      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      async function linearQuery(query) {
        const token = getToken();
        const res = await fetch(WORKER_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`,
          },
          body: JSON.stringify({ query }),
        });

        // Token rejected â€” force re-login
        if (res.status === 401) {
          clearToken();
          showLogin('Session expired. Please sign in again.');
          throw new Error('Unauthorized');
        }

        const json = await res.json().catch(() => null);
        if (!res.ok) {
          const msg = json?.errors?.[0]?.message || json?.error || `HTTP ${res.status}`;
          console.error('Linear proxy response:', json);
          throw new Error(msg);
        }
        if (json?.errors) throw new Error(json.errors[0].message);
        return json.data;
      }

      async function fetchMyIssues() {
        const query = `{
          viewer {
            assignedIssues(
              first: 15
              orderBy: updatedAt
              filter: { state: { type: { nin: ["completed", "canceled"] } } }
            ) {
              nodes {
                identifier
                title
                priority
                state { name color }
                url
              }
            }
          }
        }`;
        const data = await linearQuery(query);
        return data.viewer.assignedIssues.nodes;
      }

      async function fetchProjectUpdates() {
  const query = `{
    projects(
      first: 50
      filter: {
        members: { some: { isMe: { eq: true } } }
        state: { nin: ["completed", "canceled"] }
      }
    ) {
      nodes {
        name
        url
        projectUpdates(first: 1, orderBy: createdAt) {
          nodes {
            body
            createdAt
            health
            user { name }
          }
        }
      }
    }
  }`;
  const data = await linearQuery(query);
  return data.projects.nodes.filter(p => p.projectUpdates.nodes.length > 0);
}

      // â”€â”€ Rendering helpers â”€â”€
      function showLinearState(state) {
        document.getElementById('linear-loading').classList.toggle('hidden', state !== 'loading');
        document.getElementById('linear-error').classList.toggle('hidden', state !== 'error');
        document.getElementById('linear-data').classList.toggle('hidden', state !== 'data');
      }

      function priorityIcon(priority) {
        switch (priority) {
          case 1: return '<span class="priority-urgent text-[10px] font-bold">!!!</span>';
          case 2: return '<span class="priority-high text-[10px] font-bold">!!</span>';
          case 3: return '<span class="priority-medium text-[10px] font-bold">!</span>';
          default: return '';
        }
      }

      function relativeTime(dateStr) {
        const diff = Date.now() - new Date(dateStr).getTime();
        const mins = Math.floor(diff / 60000);
        if (mins < 1) return 'just now';
        if (mins < 60) return `${mins}m ago`;
        const hours = Math.floor(mins / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        if (days < 30) return `${days}d ago`;
        return `${Math.floor(days / 30)}mo ago`;
      }

      function healthColor(health) {
        switch (health) {
          case 'onTrack': return '#4CAF50';
          case 'atRisk': return '#F2C94C';
          case 'offTrack': return '#F26F60';
          default: return '#505058';
        }
      }

      function healthLabel(health) {
        switch (health) {
          case 'onTrack': return 'On Track';
          case 'atRisk': return 'At Risk';
          case 'offTrack': return 'Off Track';
          default: return '';
        }
      }

      function renderIssues(issues) {
        const container = document.getElementById('issues-list');
        const empty = document.getElementById('issues-empty');

        if (!issues.length) {
          container.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        container.innerHTML = issues.map(issue => `
          <a href="${escapeHtml(issue.url)}" target="_blank" rel="noopener" class="linear-issue-row">
            <span class="status-dot" style="background: ${escapeHtml(issue.state.color)};" title="${escapeHtml(issue.state.name)}"></span>
            <span class="text-muted text-[11px] flex-shrink-0">${escapeHtml(issue.identifier)}</span>
            <span class="text-text-secondary text-[12px] truncate flex-1">${escapeHtml(issue.title)}</span>
            ${priorityIcon(issue.priority)}
          </a>
        `).join('');
      }

      function renderProjects(projects) {
        const container = document.getElementById('projects-list');
        const empty = document.getElementById('projects-empty');

        projects.sort((a, b) => {
          const dateA = new Date(a.projectUpdates.nodes[0]?.createdAt || 0);
          const dateB = new Date(b.projectUpdates.nodes[0]?.createdAt || 0);
          return dateB - dateA;
        });

        if (!projects.length) {
          container.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        container.innerHTML = projects.map(project => {
          const update = project.projectUpdates.nodes[0];
          const rawBody = update.body ? update.body.replace(/[#*_~`>]/g, '').trim() : '';
          const body = rawBody.length > 120 ? rawBody.slice(0, 120) + '...' : rawBody;
          return `
            <a href="${escapeHtml(project.url)}" target="_blank" rel="noopener" class="linear-project-row">
              <div class="flex items-center gap-2 mb-1.5">
                <span class="health-dot" style="background: ${healthColor(update.health)};" title="${healthLabel(update.health)}"></span>
                <span class="text-text-primary text-[13px] font-medium truncate">${escapeHtml(project.name)}</span>
              </div>
              <p class="text-text-secondary text-[11px] leading-relaxed line-clamp-2 mb-1.5">${escapeHtml(body)}</p>
              <div class="flex items-center gap-2 text-muted text-[10px] tracking-wide">
                <span>${escapeHtml(update.user?.name || '')}</span>
                <span>&middot;</span>
                <span>${relativeTime(update.createdAt)}</span>
              </div>
            </a>
          `;
        }).join('');
      }

      async function fetchLinearData() {
        showLinearState('loading');

        const errors = [];

        const [issues, projects] = await Promise.all([
          fetchMyIssues().catch(err => { errors.push('Issues: ' + err.message); return []; }),
          fetchProjectUpdates().catch(err => { errors.push('Projects: ' + err.message); return []; }),
        ]);

        if (errors.length === 2) {
          console.error('Linear proxy errors:', errors);
          const msg = errors[0];

          // In local dev, CORS failures are expected â€” show a friendly message
          if (IS_LOCAL) {
            document.getElementById('linear-error-msg').textContent =
              'Dev mode â€” Linear API unavailable (CORS). Push to live domain to test.';
            showLinearState('error');
            return;
          }

          document.getElementById('linear-error-msg').textContent =
            msg.includes('401') || msg.includes('Unauthorized') || msg.includes('authentication')
              ? 'Linear API key is invalid. Check the worker secret.'
              : msg.includes('Failed to fetch') || msg.includes('NetworkError')
              ? 'Could not reach the Linear proxy. Is the worker deployed?'
              : `Failed to load Linear data: ${msg}`;
          showLinearState('error');
          return;
        }

        if (errors.length) console.warn('Partial Linear fetch failure:', errors);

        renderIssues(issues);
        renderProjects(projects);
        showLinearState('data');
      }

      // â”€â”€ YouTrack Proxy â”€â”€
      async function youtrackQuery(query) {
        const token = getToken();
        const res = await fetch(`${WORKER_URL}/youtrack`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`,
          },
          body: JSON.stringify({ query }),
        });

        if (res.status === 401) {
          clearToken();
          showLogin('Session expired. Please sign in again.');
          throw new Error('Unauthorized');
        }

        const json = await res.json().catch(() => null);
        if (!res.ok) {
          const msg = json?.error || `HTTP ${res.status}`;
          console.error('YouTrack proxy response:', json);
          throw new Error(msg);
        }
        return json;
      }

      function showYouTrackState(state) {
        document.getElementById('youtrack-loading').classList.toggle('hidden', state !== 'loading');
        document.getElementById('youtrack-error').classList.toggle('hidden', state !== 'error');
        document.getElementById('youtrack-data').classList.toggle('hidden', state !== 'data');
      }

      async function fetchUnassignedIssues() {
        const issues = await youtrackQuery('#Unresolved has: -Assignee project: IT, {Rail Network Support}');
        return issues;
      }

      function getYouTrackField(issue, fieldName) {
        const field = issue.customFields?.find(f => f.name === fieldName);
        return field?.value || null;
      }

      function renderYouTrackIssues(issues) {
        const container = document.getElementById('youtrack-issues-list');
        const empty = document.getElementById('youtrack-issues-empty');

        if (!issues.length) {
          container.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        container.innerHTML = issues.map(issue => {
          const state = getYouTrackField(issue, 'State');
          const stateColor = state?.color?.background || '#505058';
          const stateName = state?.name || '';
          const id = escapeHtml(issue.idReadable || '');
          const title = escapeHtml(issue.summary || '');
          const url = `https://edith.youtrack.cloud/issue/${issue.idReadable}`;
          const age = issue.created ? relativeTime(new Date(issue.created).toISOString()) : '';

          return `
            <a href="${escapeHtml(url)}" target="_blank" rel="noopener" class="linear-issue-row">
              <span class="status-dot" style="background: ${escapeHtml(stateColor)};" title="${escapeHtml(stateName)}"></span>
              <span class="text-muted text-[11px] flex-shrink-0">${id}</span>
              <span class="text-text-secondary text-[12px] truncate flex-1">${title}</span>
              ${age ? `<span class="text-muted text-[10px] flex-shrink-0 tracking-wide">${age}</span>` : ''}
            </a>
          `;
        }).join('');
      }

      async function fetchYouTrackData() {
        showYouTrackState('loading');

        try {
          const issues = await fetchUnassignedIssues();
          renderYouTrackIssues(issues);
          showYouTrackState('data');
        } catch (err) {
          console.error('YouTrack fetch error:', err);

          if (IS_LOCAL) {
            document.getElementById('youtrack-error-msg').textContent =
              'Dev mode â€” YouTrack API unavailable (CORS). Push to live domain to test.';
            showYouTrackState('error');
            return;
          }

          document.getElementById('youtrack-error-msg').textContent =
            err.message.includes('401') || err.message.includes('Unauthorized')
              ? 'YouTrack token is invalid. Check the worker secret.'
              : err.message.includes('Failed to fetch') || err.message.includes('NetworkError')
              ? 'Could not reach the YouTrack proxy. Is the worker route deployed?'
              : `Failed to load YouTrack data: ${err.message}`;
          showYouTrackState('error');
        }
      }

      // â”€â”€ F1 Next Race Countdown â”€â”€
      let f1RaceTime = null;
      let f1CountdownInterval = null;

      function showF1State(state) {
        document.getElementById('f1-loading').classList.toggle('hidden', state !== 'loading');
        document.getElementById('f1-data').classList.toggle('hidden', state !== 'data');
      }

      async function fetchNextRace() {
        showF1State('loading');
        try {
          const res = await fetch('https://f1api.dev/api/current/next');
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          const race = data.race?.[0];
          if (!race) throw new Error('No race data');

          const schedule = race.schedule?.race;
          if (!schedule?.date || !schedule?.time) throw new Error('No schedule');

          f1RaceTime = new Date(`${schedule.date}T${schedule.time}`);

          // Race name â€” strip "Formula 1" prefix
          const raceName = race.raceName
            ? race.raceName.replace(/^Formula 1\s*/i, '').trim()
            : `${race.circuit?.city || ''} Grand Prix`;

          // Season + round
          document.getElementById('f1-season-label').textContent = `${data.season} Season`;
          document.getElementById('f1-round').textContent = `Round ${race.round}`;

          // Race name + circuit
          document.getElementById('f1-race-name').textContent = raceName;
          const circuit = race.circuit;
          document.getElementById('f1-circuit').textContent = circuit
            ? `${circuit.circuitName} Â· ${circuit.city}, ${circuit.country}`
            : '';

          // Race date/time in Berlin timezone
          const berlinDate = f1RaceTime.toLocaleDateString('de-DE', {
            timeZone: 'Europe/Berlin',
            weekday: 'long',
            day: '2-digit',
            month: 'long',
            year: 'numeric',
          });
          const berlinTime = f1RaceTime.toLocaleTimeString('de-DE', {
            timeZone: 'Europe/Berlin',
            hour: '2-digit',
            minute: '2-digit',
          });
          document.getElementById('f1-race-datetime').textContent = `${berlinDate} Â· ${berlinTime} Uhr`;

          // Start countdown
          updateF1Countdown();
          f1CountdownInterval = setInterval(updateF1Countdown, 1000);

          showF1State('data');
        } catch (e) {
          console.warn('F1 API unavailable:', e.message);
          // Hide the section entirely on failure
          document.getElementById('f1-section').style.display = 'none';
        }
      }

      function updateF1Countdown() {
        if (!f1RaceTime) return;
        const now = Date.now();
        const diff = f1RaceTime.getTime() - now;

        const daysEl = document.getElementById('f1-days');
        const hoursEl = document.getElementById('f1-hours');
        const minsEl = document.getElementById('f1-mins');
        const secsEl = document.getElementById('f1-secs');
        const liveLabel = document.getElementById('f1-live-label');

        if (diff <= 0 && diff > -10800000) {
          // Race is live (within 3 hours of start)
          daysEl.textContent = '00';
          hoursEl.textContent = '00';
          minsEl.textContent = '00';
          secsEl.textContent = '00';
          liveLabel.innerHTML = '<span class="f1-live-dot"></span> <span class="text-[#E10600] font-medium">LIVE</span>';
          return;
        }

        if (diff <= 0) {
          // Race is over, stop updating
          clearInterval(f1CountdownInterval);
          liveLabel.textContent = 'Race completed';
          return;
        }

        const days = Math.floor(diff / 86400000);
        const hours = Math.floor((diff % 86400000) / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const secs = Math.floor((diff % 60000) / 1000);

        daysEl.textContent = String(days).padStart(2, '0');
        hoursEl.textContent = String(hours).padStart(2, '0');
        minsEl.textContent = String(mins).padStart(2, '0');
        secsEl.textContent = String(secs).padStart(2, '0');

        // Contextual label
        if (days === 0 && hours < 1) {
          liveLabel.textContent = 'Starting soon';
        } else if (days <= 1) {
          liveLabel.textContent = 'Race day approaching';
        } else {
          liveLabel.textContent = '';
        }
      }

      // â”€â”€ Dashboard init (called after successful auth) â”€â”€
      let dashboardInitialized = false;

      function initDashboard() {
        if (dashboardInitialized) return;
        dashboardInitialized = true;

        const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

        tl.fromTo('#header',
          { opacity: 0, y: -8 },
          { opacity: 1, y: 0, duration: 0.6 }
        );

        tl.fromTo('#search-form',
          { opacity: 0, y: 10 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.35'
        );

        tl.fromTo('#search-hints',
          { opacity: 0, y: 6 },
          { opacity: 1, y: 0, duration: 0.4 },
          '-=0.3'
        );

        const cards = document.querySelectorAll('#card-grid .dash-card');
        tl.fromTo(cards,
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.45, stagger: 0.06 },
          '-=0.3'
        );

        tl.fromTo('#youtrack-section',
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.15'
        );

        tl.fromTo('#linear-section',
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.15'
        );

        tl.fromTo('#f1-section',
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.15'
        );

        tl.fromTo('footer',
          { opacity: 0 },
          { opacity: 1, duration: 0.5 },
          '-=0.15'
        );

        // â”€â”€ Card hover effects â”€â”€
        function hexToRgba(hex, a) {
          const r = parseInt(hex.slice(1, 3), 16);
          const g = parseInt(hex.slice(3, 5), 16);
          const b = parseInt(hex.slice(5, 7), 16);
          return `rgba(${r},${g},${b},${a})`;
        }

        cards.forEach(card => {
          const glow = document.createElement('div');
          glow.classList.add('card-glow');
          card.insertBefore(glow, card.firstChild);

          const accent = document.createElement('div');
          accent.classList.add('card-accent');
          card.appendChild(accent);

          const icon = card.querySelector('.card-icon');
          const raw = getComputedStyle(card).getPropertyValue('--card-color').trim();
          const c = raw.startsWith('#') ? raw : '#ffffff';

          const ht = gsap.timeline({ paused: true, defaults: { ease: 'power3.out' } });

          ht.to(card, {
            y: 2,
            scale: 0.975,
            backgroundColor: '#141416',
            borderColor: hexToRgba(c, 0.14),
            boxShadow: `inset 0 2px 8px 0 rgba(0,0,0,0.4), inset 0 1px 0 0 ${hexToRgba(c, 0.06)}`,
            duration: 0.2,
            ease: 'power2.out',
          }, 0)
          .to(glow, {
            opacity: 1,
            duration: 0.3,
          }, 0)
          .to(accent, {
            width: '100%',
            opacity: 0.7,
            duration: 0.3,
            ease: 'power2.inOut',
          }, 0)
          .to(icon, {
            opacity: 0.8,
            y: 1,
            rotation: 45,
            filter: `drop-shadow(0 0 6px ${hexToRgba(c, 0.6)})`,
            duration: 0.3,
            ease: 'power2.out',
          }, 0);

          card.addEventListener('mouseenter', () => ht.timeScale(1).play());
          card.addEventListener('mouseleave', () => ht.timeScale(1).reverse());
        });

        initLastAccessTracking();
        fetchLinearData();
        fetchYouTrackData();
        fetchNextRace();
      }

      // â”€â”€ Boot: check existing token â”€â”€
      document.addEventListener('DOMContentLoaded', () => {
        if (IS_LOCAL) {
          // Dev mode: skip auth entirely, show dashboard immediately
          console.info('%c[DEV MODE]%c Running locally â€” auth bypassed, API calls may fail (CORS)',
            'color:#F2C94C;font-weight:bold', 'color:inherit');
          showApp();
          initDashboard();
          return;
        }
        if (isTokenValid()) {
          showApp();
          initDashboard();
        } else {
          clearToken();
          showLogin();
        }
      });
    </script>
  </body>
</html>
