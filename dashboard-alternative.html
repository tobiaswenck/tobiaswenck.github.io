<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>

    <!-- Geist Mono from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&display=swap" rel="stylesheet">

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'geist': ['"Geist Mono"', 'monospace'],
            },
            colors: {
              'dash-bg': '#0b0b0d',
              'surface': '#141416',
              'surface-hover': '#19191c',
              'border': 'rgba(255, 255, 255, 0.06)',
              'border-hover': 'rgba(255, 255, 255, 0.1)',
              'muted': '#505058',
              'muted-light': '#7e7e86',
              'text-primary': '#ededef',
              'text-secondary': '#a0a0a8',
            },
          },
        },
      }
    </script>

    <style>
      /* Hide scrollbar */
      body { scrollbar-width: none; }
      body::-webkit-scrollbar { display: none; }

      /* Card system */
      .dash-card {
        --card-color: #fff;
        background: #141416;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        will-change: transform;
      }

      /* Glow overlay â€” injected via JS */
      .card-glow {
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse 80% 55% at 50% 0%, color-mix(in srgb, var(--card-color) 14%, transparent), transparent);
        opacity: 0;
        pointer-events: none;
      }

      /* Accent line â€” injected via JS, expands from center */
      .card-accent {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 0%;
        height: 1.5px;
        background: linear-gradient(90deg, transparent, var(--card-color), transparent);
        opacity: 0;
        pointer-events: none;
        z-index: 1;
      }

      /* Search input */
      #search-input {
        background: #0e0e10;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition: border-color 0.3s ease;
      }
      #search-input:focus {
        border-color: rgba(255, 255, 255, 0.12);
      }

      /* Search button */
      .search-btn {
        background: #141416;
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition:
          border-color 0.3s ease,
          background 0.3s ease;
      }
      .search-btn:hover {
        background: #19191c;
        border-color: rgba(255, 255, 255, 0.1);
      }
      .search-btn:active {
        background: #111113;
      }

      /* Separator */
      .divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.04);
      }

      /* Visibility helper for GSAP */
      .gs-hidden { opacity: 0; }

      /* Linear issue rows */
      .linear-issue-row {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        transition: background 0.2s ease;
        text-decoration: none;
      }
      .linear-issue-row:hover { background: #19191c; }
      .linear-issue-row:last-child { border-bottom: none; }

      /* Linear project rows */
      .linear-project-row {
        display: block;
        padding: 12px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        transition: background 0.2s ease;
        text-decoration: none;
      }
      .linear-project-row:hover { background: #19191c; }
      .linear-project-row:last-child { border-bottom: none; }

      /* Status & health dots */
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
      }
      .health-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        flex-shrink: 0;
        display: inline-block;
      }

      /* Priority indicators */
      .priority-urgent { color: #F26F60; }
      .priority-high { color: #F2994A; }
      .priority-medium { color: #F2C94C; }

      /* Skeleton loader */
      @keyframes skeleton-pulse {
        0%, 100% { opacity: 0.04; }
        50% { opacity: 0.08; }
      }
      .skeleton-line {
        height: 12px;
        background: #fff;
        border-radius: 4px;
        animation: skeleton-pulse 1.5s ease-in-out infinite;
      }

      /* Line clamp fallback */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>
  </head>

  <body class="font-geist bg-dash-bg text-text-primary min-h-screen overflow-x-hidden">

    <!-- Main content -->
    <main class="min-h-screen flex flex-col px-6 sm:px-10 lg:px-16 py-16 lg:py-20 mx-auto" style="max-width: 1060px;">

      <!-- Header -->
      <header class="flex items-start justify-between mb-14 gs-hidden" id="header">
        <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight text-text-primary">Hey!&nbsp;ðŸ‘‹</h1>
        <div class="text-right text-muted-light text-xs leading-relaxed tracking-wide">
          <div id="date-display"></div>
          <div><span id="time-display">00:00:00</span> Uhr</div>
        </div>
      </header>

      <!-- Search bar -->
      <form id="search-form" class="flex items-center gap-3 mb-12 gs-hidden">
        <input
          id="search-input"
          type="text"
          autocomplete="off"
          class="flex-1 h-10 rounded-lg px-4 text-[13px] text-text-primary placeholder-muted focus:outline-none"
          placeholder=""
        >
        <button
          type="submit"
          class="search-btn h-10 px-4 rounded-lg flex items-center gap-2 text-[13px] text-muted-light cursor-pointer"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.4" d="M1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12Z" fill="currentColor"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16C13.8638 16 15.4299 14.7252 15.874 13H12C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11H17C17.5523 11 18 11.4477 18 12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C13.6566 6 15.1579 6.67267 16.2426 7.75736C16.6332 8.14788 16.6332 8.78105 16.2426 9.17157C15.8521 9.5621 15.219 9.5621 14.8284 9.17157C14.1035 8.44662 13.1048 8 12 8Z" fill="currentColor"/>
          </svg>
          Search
        </button>
      </form>

      <!-- Bookmark cards grid -->
      <section class="grid grid-cols-2 lg:grid-cols-3 gap-3 mb-auto" id="card-grid">

        <!-- Card: YouTrack -->
        <a href="https://edith.youtrack.cloud/tickets?u=1" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #E20F86">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">YouTrack</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: GitLab -->
        <a href="https://gitlab.dev.edith-bahn.de/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #E24329">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">GitLab</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Suite -->
        <a href="https://suite.intern.edith-bahn.de/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #00427F">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Suite</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Canny -->
        <a href="https://edith.canny.io/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #525DF9">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Canny</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Mobbin -->
        <a href="https://mobbin.com/discover/apps/ios/latest" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FFFFFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Mobbin</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Rail Network -->
        <a href="https://customer.s.rail-network.de/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #006AFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Rail Network</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Docmost -->
        <a href="https://wiki.intern.edith-bahn.de/home" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #0B60D8">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Docmost</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: Localhost -->
        <a href="http://localhost:5173/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FFFFFF">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">Localhost</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

        <!-- Card: YouTube -->
        <a href="https://www.youtube.com/" target="_blank" rel="noopener" class="dash-card group p-5 flex flex-col justify-between min-h-[140px] gs-hidden" style="--card-color: #FF0033">
          <div class="flex items-start justify-between">
            <span class="text-text-primary font-medium text-[15px]">YouTube</span>
            <svg class="card-icon opacity-30" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 17L17 7M17 7H8M17 7V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div class="text-muted text-[11px] tracking-wide">Letzter Zugriff</div>
            <div class="text-muted-light text-[11px] tracking-wide">26.02.2025</div>
          </div>
        </a>

      </section>

      <!-- Linear Section -->
      <section class="mt-12 gs-hidden" id="linear-section">
        <div class="divider mb-8"></div>

        <div class="flex items-center gap-3 mb-5">
          <div class="w-1 h-4 rounded-full" style="background: #5E6AD2;"></div>
          <h2 class="text-text-primary font-medium text-[15px] tracking-wide">Linear</h2>
        </div>

        <div id="linear-content">
          <!-- Loading skeleton -->
          <div id="linear-loading" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-3">
            <div class="dash-card p-5" style="--card-color: #5E6AD2">
              <div class="text-muted text-[11px] tracking-wide mb-4">My Issues</div>
              <div class="space-y-3">
                <div class="skeleton-line w-3/4"></div>
                <div class="skeleton-line w-1/2"></div>
                <div class="skeleton-line w-2/3"></div>
                <div class="skeleton-line w-3/5"></div>
              </div>
            </div>
            <div class="dash-card p-5" style="--card-color: #5E6AD2">
              <div class="text-muted text-[11px] tracking-wide mb-4">Project Updates</div>
              <div class="space-y-3">
                <div class="skeleton-line w-3/4"></div>
                <div class="skeleton-line w-1/2"></div>
                <div class="skeleton-line w-2/3"></div>
              </div>
            </div>
          </div>

          <!-- Error state -->
          <div id="linear-error" class="hidden dash-card p-5 text-center" style="--card-color: #F26F60">
            <p class="text-muted-light text-[13px]" id="linear-error-msg"></p>
          </div>

          <!-- Data display -->
          <div id="linear-data" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-3">
            <div class="dash-card p-0 overflow-hidden" style="--card-color: #5E6AD2">
              <div class="px-5 pt-5 pb-3">
                <div class="text-muted text-[11px] tracking-wide">My Issues</div>
              </div>
              <div id="issues-list"></div>
              <div id="issues-empty" class="hidden px-5 pb-5 text-muted text-[12px]">No issues assigned</div>
            </div>
            <div class="dash-card p-0 overflow-hidden" style="--card-color: #5E6AD2">
              <div class="px-5 pt-5 pb-3">
                <div class="text-muted text-[11px] tracking-wide">Project Updates</div>
              </div>
              <div id="projects-list"></div>
              <div id="projects-empty" class="hidden px-5 pb-5 text-muted text-[12px]">No project updates</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <div class="mt-14">
        
        <footer class="flex items-center justify-center gap-1.5 text-muted text-[11px] tracking-wide">
          <span>Made with</span>
          <svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.18621 5.26615L3.61813 2.69266C3.27249 2.34628 3.2756 1.78158 3.6251 1.43136C3.97459 1.08113 4.53811 1.078 4.88375 1.42437L9.42534 5.93077C10.976 7.48471 11.8699 9.52165 10.1389 11.6266L9.95431 11.8116C8.59491 13.1738 6.39084 13.1738 5.0314 11.8116L3.17131 9.97414C2.82567 9.62776 2.83272 9.05913 3.18708 8.70405C3.523 8.36741 4.05042 8.34355 4.39884 8.63703M6.18621 5.26615L7.64985 6.73285M6.18621 5.26615C5.84058 4.91978 5.25824 4.92785 4.90233 5.28451C4.54642 5.64116 4.53811 6.21106 4.88375 6.55744L5.30833 6.98293M4.39884 8.63703L4.03412 8.2823C3.68847 7.93592 3.69679 7.366 4.0527 7.00935C4.4086 6.6527 4.96268 6.63654 5.30833 6.98293M4.39884 8.63703L5.05823 9.27828M4.39884 8.63703C4.41797 8.65313 4.43656 8.67022 4.45455 8.68824M5.30833 6.98293L6.34884 8.02564M7.07935 3.60298C7.177 2.7065 8.23873 1.77718 9.56447 2.41404C9.69035 2.47452 9.7901 2.58893 9.79127 2.72883C9.79308 2.95419 9.69414 3.23242 9.37704 3.41691C8.92344 3.68081 8.18039 4.68916 9.17229 5.68314" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>by Tobias Wenck</span>
        </footer>
      </div>

    </main>

    <script>
      // â”€â”€ Clock â”€â”€
      function updateClock() {
        const now = new Date();
        const pad = (n) => String(n).padStart(2, '0');
        document.getElementById('date-display').textContent =
          `${pad(now.getDate())}.${pad(now.getMonth() + 1)}.${now.getFullYear()}`;
        document.getElementById('time-display').textContent =
          `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      }
      updateClock();
      setInterval(updateClock, 1000);

      // â”€â”€ Google search â”€â”€
      document.getElementById('search-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const q = document.getElementById('search-input').value.trim();
        if (q) window.location.href = 'https://www.google.com/search?q=' + encodeURIComponent(q);
      });

      // â”€â”€ Linear Proxy â”€â”€
      // Points to the Cloudflare Worker that holds the API key server-side.
      // Deploy the worker from /worker and set your LINEAR_API_KEY secret.
      const LINEAR_PROXY = 'https://linear-proxy.tobiaswenck.workers.dev';

      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      async function linearQuery(query) {
        const res = await fetch(LINEAR_PROXY, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query }),
        });
        const json = await res.json().catch(() => null);
        if (!res.ok) {
          const msg = json?.errors?.[0]?.message || json?.error || `HTTP ${res.status}`;
          console.error('Linear proxy response:', json);
          throw new Error(msg);
        }
        if (json?.errors) throw new Error(json.errors[0].message);
        return json.data;
      }

      async function fetchMyIssues() {
        const query = `{
          viewer {
            assignedIssues(
              first: 15
              orderBy: updatedAt
              filter: { state: { type: { nin: ["completed", "canceled"] } } }
            ) {
              nodes {
                identifier
                title
                priority
                state { name color }
                url
              }
            }
          }
        }`;
        const data = await linearQuery(query);
        return data.viewer.assignedIssues.nodes;
      }

      async function fetchProjectUpdates() {
        // Use root projects query â€” the teamMemberships path misses cross-team projects
        const query = `{
          projects(
            first: 50
            filter: {
              members: { some: { isMe: { eq: true } } }
              state: { nin: ["completed", "canceled"] }
            }
          ) {
            nodes {
              name
              url
              projectUpdates(last: 1) {
                nodes {
                  body
                  createdAt
                  health
                  user { name }
                }
              }
            }
          }
        }`;
        const data = await linearQuery(query);
        // Only show projects that have at least one update
        return data.projects.nodes.filter(p => p.projectUpdates.nodes.length > 0);
      }

      // â”€â”€ Rendering helpers â”€â”€
      function showLinearState(state) {
        document.getElementById('linear-loading').classList.toggle('hidden', state !== 'loading');
        document.getElementById('linear-error').classList.toggle('hidden', state !== 'error');
        document.getElementById('linear-data').classList.toggle('hidden', state !== 'data');
      }

      function priorityIcon(priority) {
        switch (priority) {
          case 1: return '<span class="priority-urgent text-[10px] font-bold">!!!</span>';
          case 2: return '<span class="priority-high text-[10px] font-bold">!!</span>';
          case 3: return '<span class="priority-medium text-[10px] font-bold">!</span>';
          default: return '';
        }
      }

      function relativeTime(dateStr) {
        const diff = Date.now() - new Date(dateStr).getTime();
        const mins = Math.floor(diff / 60000);
        if (mins < 1) return 'just now';
        if (mins < 60) return `${mins}m ago`;
        const hours = Math.floor(mins / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        if (days < 30) return `${days}d ago`;
        return `${Math.floor(days / 30)}mo ago`;
      }

      function healthColor(health) {
        switch (health) {
          case 'onTrack': return '#4CAF50';
          case 'atRisk': return '#F2C94C';
          case 'offTrack': return '#F26F60';
          default: return '#505058';
        }
      }

      function healthLabel(health) {
        switch (health) {
          case 'onTrack': return 'On Track';
          case 'atRisk': return 'At Risk';
          case 'offTrack': return 'Off Track';
          default: return '';
        }
      }

      function renderIssues(issues) {
        const container = document.getElementById('issues-list');
        const empty = document.getElementById('issues-empty');

        if (!issues.length) {
          container.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        container.innerHTML = issues.map(issue => `
          <a href="${escapeHtml(issue.url)}" target="_blank" rel="noopener" class="linear-issue-row">
            <span class="status-dot" style="background: ${escapeHtml(issue.state.color)};" title="${escapeHtml(issue.state.name)}"></span>
            <span class="text-muted text-[11px] flex-shrink-0">${escapeHtml(issue.identifier)}</span>
            <span class="text-text-secondary text-[12px] truncate flex-1">${escapeHtml(issue.title)}</span>
            ${priorityIcon(issue.priority)}
          </a>
        `).join('');
      }

      function renderProjects(projects) {
        const container = document.getElementById('projects-list');
        const empty = document.getElementById('projects-empty');

        if (!projects.length) {
          container.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        container.innerHTML = projects.map(project => {
          const update = project.projectUpdates.nodes[0];
          const rawBody = update.body ? update.body.replace(/[#*_~`>]/g, '').trim() : '';
          const body = rawBody.length > 120 ? rawBody.slice(0, 120) + '...' : rawBody;
          return `
            <a href="${escapeHtml(project.url)}" target="_blank" rel="noopener" class="linear-project-row">
              <div class="flex items-center gap-2 mb-1.5">
                <span class="health-dot" style="background: ${healthColor(update.health)};" title="${healthLabel(update.health)}"></span>
                <span class="text-text-primary text-[13px] font-medium truncate">${escapeHtml(project.name)}</span>
              </div>
              <p class="text-text-secondary text-[11px] leading-relaxed line-clamp-2 mb-1.5">${escapeHtml(body)}</p>
              <div class="flex items-center gap-2 text-muted text-[10px] tracking-wide">
                <span>${escapeHtml(update.user?.name || '')}</span>
                <span>&middot;</span>
                <span>${relativeTime(update.createdAt)}</span>
              </div>
            </a>
          `;
        }).join('');
      }

      async function fetchLinearData() {
        showLinearState('loading');

        const errors = [];

        // Fetch issues and projects independently so one failing doesn't kill the other
        const [issues, projects] = await Promise.all([
          fetchMyIssues().catch(err => { errors.push('Issues: ' + err.message); return []; }),
          fetchProjectUpdates().catch(err => { errors.push('Projects: ' + err.message); return []; }),
        ]);

        if (errors.length === 2) {
          // Both failed
          console.error('Linear proxy errors:', errors);
          const msg = errors[0];
          document.getElementById('linear-error-msg').textContent =
            msg.includes('401') || msg.includes('Unauthorized') || msg.includes('authentication')
              ? 'Linear API key is invalid. Check the worker secret.'
              : msg.includes('Failed to fetch') || msg.includes('NetworkError')
              ? 'Could not reach the Linear proxy. Is the worker deployed?'
              : `Failed to load Linear data: ${msg}`;
          showLinearState('error');
          return;
        }

        if (errors.length) console.warn('Partial Linear fetch failure:', errors);

        renderIssues(issues);
        renderProjects(projects);
        showLinearState('data');
      }

      // â”€â”€ GSAP entrance â”€â”€
      document.addEventListener('DOMContentLoaded', () => {
        const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

        // Header
        tl.fromTo('#header',
          { opacity: 0, y: -8 },
          { opacity: 1, y: 0, duration: 0.6 }
        );

        // Search form
        tl.fromTo('#search-form',
          { opacity: 0, y: 10 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.35'
        );

        // Bookmark cards â€” staggered (scoped to card-grid only)
        const cards = document.querySelectorAll('#card-grid .dash-card');
        tl.fromTo(cards,
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.45, stagger: 0.06 },
          '-=0.3'
        );

        // Linear section
        tl.fromTo('#linear-section',
          { opacity: 0, y: 16 },
          { opacity: 1, y: 0, duration: 0.5 },
          '-=0.15'
        );

        // Footer
        tl.fromTo('footer',
          { opacity: 0 },
          { opacity: 1, duration: 0.5 },
          '-=0.15'
        );

        // â”€â”€ Card hover effects (GSAP) â€” bookmark cards only â”€â”€
        function hexToRgba(hex, a) {
          const r = parseInt(hex.slice(1, 3), 16);
          const g = parseInt(hex.slice(3, 5), 16);
          const b = parseInt(hex.slice(5, 7), 16);
          return `rgba(${r},${g},${b},${a})`;
        }

        cards.forEach(card => {
          // Inject glow overlay
          const glow = document.createElement('div');
          glow.classList.add('card-glow');
          card.insertBefore(glow, card.firstChild);

          // Inject accent line
          const accent = document.createElement('div');
          accent.classList.add('card-accent');
          card.appendChild(accent);

          const icon = card.querySelector('.card-icon');
          const raw = getComputedStyle(card).getPropertyValue('--card-color').trim();
          const c = raw.startsWith('#') ? raw : '#ffffff';

          // Build hover timeline (paused)
          const ht = gsap.timeline({ paused: true, defaults: { ease: 'power3.out' } });

          ht.to(card, {
            y: 2,
            scale: 0.975,
            backgroundColor: '#141416',
            borderColor: hexToRgba(c, 0.14),
            boxShadow: `inset 0 2px 8px 0 rgba(0,0,0,0.4), inset 0 1px 0 0 ${hexToRgba(c, 0.06)}`,
            duration: 0.2,
            ease: 'power2.out',
          }, 0)
          .to(glow, {
            opacity: 1,
            duration: 0.3,
          }, 0)
          .to(accent, {
            width: '100%',
            opacity: 0.7,
            duration: 0.3,
            ease: 'power2.inOut',
          }, 0)
          .to(icon, {
            opacity: 0.8,
            y: 1,
            rotation: 45,
            filter: `drop-shadow(0 0 6px ${hexToRgba(c, 0.6)})`,
            duration: 0.3,
            ease: 'power2.out',
          }, 0);

          card.addEventListener('mouseenter', () => ht.timeScale(1).play());
          card.addEventListener('mouseleave', () => ht.timeScale(1).reverse());
        });

        // â”€â”€ Init Linear data â”€â”€
        fetchLinearData();
      });
    </script>
  </body>
</html>
